/**
 * Bot Unificado - Renova√ß√£o nos 3 Servidores
 * 
 * Renova um cliente automaticamente nos 3 servidores:
 * - Servidor 1: TropicalPlayTV (https://painel.tropicalplaytv.com)
 * - Servidor 2: SpiderTV (https://spidertv.sigma.st)
 * - Servidor 3: Premium Server (https://premiumserver.sigma.st)
 *
 * Uso: node renovar-3-servidores.cjs [CLIENTE_ID] [MESES]
 * Exemplo: node renovar-3-servidores.cjs 648718886 1
 * Exemplo: node renovar-3-servidores.cjs 648718886 3
 * Exemplo: node renovar-3-servidores.cjs 648718886 6
 * Exemplo: node renovar-3-servidores.cjs 648718886 12
 */

const puppeteer = require('puppeteer');

// Configura√ß√µes dos servidores
const SERVIDORES = {
    servidor1: {
        nome: 'TropicalPlayTV',
        url: 'https://painel.tropicalplaytv.com',
        usuario: 'Eider Goncalves',
        senha: 'Goncalves1@',
        emoji: 'üå¥'
    },
    servidor2: {
        nome: 'SpiderTV',
        url: 'https://spidertv.sigma.st',
        usuario: 'tropicalplay',
        senha: 'Virginia13',
        emoji: 'üï∑Ô∏è'
    },
    servidor3: {
        nome: 'Premium Server',
        url: 'https://premiumserver.sigma.st',
        usuario: 'eidergdc',
        senha: 'Premium2025@',
        emoji: '‚≠ê'
    }
};

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

function log(servidor, mensagem, tipo = 'info') {
    const timestamp = new Date().toLocaleTimeString();
    const emoji = SERVIDORES[servidor]?.emoji || 'ü§ñ';
    const nome = SERVIDORES[servidor]?.nome || servidor;
    
    let prefix = '';
    switch (tipo) {
        case 'success': prefix = '‚úÖ'; break;
        case 'error': prefix = '‚ùå'; break;
        case 'warning': prefix = '‚ö†Ô∏è'; break;
        case 'info': prefix = '‚ÑπÔ∏è'; break;
        default: prefix = 'üìù'; break;
    }
    
    console.log(`[${timestamp}] ${emoji} ${nome} ${prefix} ${mensagem}`);
}

// Fun√ß√£o para obter o plano correto baseado no servidor e meses
function obterPlano(servidor, meses) {
    const planos = {
        servidor2: {
            1: 'PLANO COMPLETO',
            3: 'PLANO COMPLETO - TRIMESTRAL',
            6: 'PLANO COMPLETO - SEMESTRAL',
            12: 'PLANO COMPLETO - ANUAL'
        },
        servidor3: {
            1: '1 M√äS COMPLETO C/ ADULTO',
            3: '3 M√äS C/ ADULTO',
            6: '6 M√äS C/ ADULTO',
            12: 'ANUAL COMPLETO'
        }
    };
    
    return planos[servidor]?.[meses] || planos[servidor]?.[1];
}

// Fun√ß√£o para renovar no Servidor 1 (TropicalPlayTV)
async function renovarServidor1(clienteId, meses, browser) {
    const servidor = 'servidor1';
    const config = SERVIDORES[servidor];
    
    try {
        log(servidor, 'Iniciando renova√ß√£o...');
        
        const page = await browser.newPage();
        await page.setViewport({ width: 1280, height: 720 });
        await page.setUserAgent('Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36');
        
        // Navegar para o painel
        log(servidor, 'Navegando para o painel...');
        await page.goto(config.url, { waitUntil: 'networkidle0', timeout: 30000 });
        await sleep(2000);
        
        // Fazer login
        log(servidor, 'Fazendo login...');
        const userField = await page.$('#username');
        const passField = await page.$('#password');
        
        if (userField && passField) {
            // Colar dados diretamente para ser mais r√°pido
            await page.evaluate((element, value) => {
                element.value = value;
                element.dispatchEvent(new Event('input', { bubbles: true }));
            }, userField, config.usuario);
            
            await page.evaluate((element, value) => {
                element.value = value;
                element.dispatchEvent(new Event('input', { bubbles: true }));
            }, passField, config.senha);
            
            const loginBtn = await page.$('#button-login');
            if (loginBtn) {
                await loginBtn.click();
                await sleep(3000);
                log(servidor, 'Login realizado!', 'success');
            }
        }
        
        // Navegar para clientes
        log(servidor, 'Navegando para p√°gina de clientes...');
        await page.goto(`${config.url}/iptv/clients`, { waitUntil: 'networkidle0', timeout: 30000 });
        await sleep(3000);
        
        // Buscar cliente
        log(servidor, `Buscando cliente ${clienteId}...`);
        const searchField = await page.$('input[type="search"]');
        if (searchField) {
            // Colar ID do cliente diretamente
            await page.evaluate((element, value) => {
                element.value = value;
                element.dispatchEvent(new Event('input', { bubbles: true }));
            }, searchField, clienteId);
            
            await page.keyboard.press('Enter');
            await sleep(3000);
        }
        
        // Procurar bot√£o de renova√ß√£o na linha do cliente
        log(servidor, 'Procurando bot√£o de renova√ß√£o...');
        
        // Primeiro, procurar a linha que cont√©m o cliente
        const clientRow = await page.evaluateHandle((clientId) => {
            const rows = document.querySelectorAll('tr');
            for (const row of rows) {
                if (row.textContent.includes(clientId)) {
                    return row;
                }
            }
            return null;
        }, clienteId);
        
        if (clientRow) {
            log(servidor, 'Linha do cliente encontrada');
            
            // Procurar bot√£o de renova√ß√£o espec√≠fico do Servidor 1
            const renewIcon = await clientRow.$('i.fad.fa-calendar-alt');
            
            if (renewIcon) {
                log(servidor, '√çcone de renova√ß√£o encontrado');
                // Clicar no bot√£o pai do √≠cone
                await page.evaluate((icon) => {
                    const button = icon.closest('button') || icon.closest('a') || icon.parentElement;
                    if (button) {
                        button.click();
                    } else {
                        icon.click();
                    }
                }, renewIcon);
                await sleep(2000);
                
                // Se houver campo para selecionar meses
                const monthsField = await page.$('select[name="months"], input[name="months"], select[id*="month"]');
                if (monthsField) {
                    log(servidor, `Selecionando ${meses} m√™s(es)...`);
                    try {
                        await monthsField.selectOption(String(meses));
                    } catch (e) {
                        // Se selectOption falhar, tentar com evaluate
                        await page.evaluate((element, value) => {
                            element.value = value;
                            element.dispatchEvent(new Event('change', { bubbles: true }));
                        }, monthsField, String(meses));
                    }
                    await sleep(1000);
                }
                
                // Confirmar renova√ß√£o se houver modal
                const confirmSelectors = [
                    'button[type="submit"]',
                    'button[class*="confirm"]',
                    'button[class*="renew"]',
                    '.btn-primary',
                    '.btn-success'
                ];
                
                let confirmBtn = null;
                for (const selector of confirmSelectors) {
                    confirmBtn = await page.$(selector);
                    if (confirmBtn) {
                        const btnText = await page.evaluate(el => el.textContent, confirmBtn);
                        if (btnText.toLowerCase().includes('confirm') || 
                            btnText.toLowerCase().includes('renew') || 
                            btnText.toLowerCase().includes('ok') ||
                            btnText.toLowerCase().includes('renovar')) {
                            break;
                        }
                        confirmBtn = null;
                    }
                }
                
                if (confirmBtn) {
                    log(servidor, 'Confirmando renova√ß√£o...');
                    await confirmBtn.click();
                    await sleep(3000);
                }
                
                log(servidor, `Renova√ß√£o de ${meses} m√™s(es) realizada com sucesso!`, 'success');
                await page.close();
                return { sucesso: true, servidor: config.nome, meses };
            } else {
                log(servidor, 'Bot√£o de renova√ß√£o n√£o encontrado na linha do cliente', 'warning');
                await page.close();
                return { sucesso: false, servidor: config.nome, erro: 'Bot√£o n√£o encontrado na linha' };
            }
        } else {
            log(servidor, 'Cliente n√£o encontrado na tabela', 'warning');
            await page.close();
            return { sucesso: false, servidor: config.nome, erro: 'Cliente n√£o encontrado' };
        }
        
    } catch (error) {
        log(servidor, `Erro: ${error.message}`, 'error');
        return { sucesso: false, servidor: config.nome, erro: error.message };
    }
}

// Fun√ß√£o para renovar no Servidor 2 (SpiderTV)
async function renovarServidor2(clienteId, meses, browser) {
    const servidor = 'servidor2';
    const config = SERVIDORES[servidor];
    
    try {
        log(servidor, 'Iniciando renova√ß√£o...');
        
        const page = await browser.newPage();
        await page.setViewport({ width: 1280, height: 720 });
        await page.setUserAgent('Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36');
        
        // Navegar para login
        log(servidor, 'Navegando para p√°gina de login...');
        await page.goto(`${config.url}/#/sign-in`, { waitUntil: 'networkidle0', timeout: 30000 });
        await sleep(3000);
        
        // Fazer login
        log(servidor, 'Fazendo login...');
        const userField = await page.$('input[type="text"], input[type="email"]');
        const passField = await page.$('input[type="password"]');
        
        if (userField && passField) {
            await page.evaluate((element, value) => {
                element.value = value;
                element.dispatchEvent(new Event('input', { bubbles: true }));
            }, userField, config.usuario);
            
            await page.evaluate((element, value) => {
                element.value = value;
                element.dispatchEvent(new Event('input', { bubbles: true }));
            }, passField, config.senha);
            
            const loginBtn = await page.$('button[type="submit"]');
            if (loginBtn) {
                await loginBtn.click();
                await sleep(4000);
                log(servidor, 'Login realizado!', 'success');
            }
        }
        
        // Navegar para clientes
        log(servidor, 'Navegando para p√°gina de clientes...');
        await page.goto(`${config.url}/#/customers`, { waitUntil: 'networkidle0', timeout: 30000 });
        await sleep(3000);
        
        // Buscar cliente
        log(servidor, `Buscando cliente ${clienteId}...`);
        const searchField = await page.$('input[placeholder="Pesquisar"]');
        if (searchField) {
            await page.evaluate((element, value) => {
                element.value = value;
                element.dispatchEvent(new Event('input', { bubbles: true }));
            }, searchField, clienteId);
            
            await searchField.press('Enter');
            await sleep(4000);
        }
        
        // Procurar bot√£o de renova√ß√£o
        log(servidor, 'Procurando bot√£o de renova√ß√£o...');
        const renewBtn = await page.$('button.btn-warning i.fa-calendar-plus');
        
        if (renewBtn) {
            const parentButton = await page.evaluateHandle(el => el.parentElement, renewBtn);
            await parentButton.click();
            await sleep(3000);
            
            // Aguardar modal e selecionar plano
            await page.waitForSelector('#renewModal', { timeout: 10000 });
            log(servidor, 'Modal de renova√ß√£o aberto');
            
            // Selecionar o plano correto baseado nos meses
            const planoCorreto = obterPlano('servidor2', meses);
            log(servidor, `Selecionando plano: ${planoCorreto}`);
            
            // Procurar dropdown de planos usando o seletor correto
            const planSelect = await page.$('#renewModal .el-select__selected-item, #renewModal .el-select');
            if (planSelect) {
                await planSelect.click();
                await sleep(2000); // Aguardar dropdown abrir
                
                // Aguardar dropdown aparecer completamente
                await page.waitForSelector('.el-select-dropdown__item', { timeout: 10000 });
                await sleep(1000); // Aguardar estabilizar
                
                // Procurar e clicar na op√ß√£o do plano usando busca por texto espec√≠fico
                const planSelected = await page.evaluate((meses) => {
                    const textosProcurar = {
                        1: 'PLANO COMPLETO',
                        3: 'PLANO COMPLETO - TRIMESTRAL', 
                        6: 'PLANO COMPLETO - SEMESTRAL',
                        12: 'PLANO COMPLETO - ANUAL'
                    };
                    
                    const textoProcurar = textosProcurar[meses] || 'PLANO COMPLETO';
                    console.log(`Procurando por: "${textoProcurar}"`);
                    
                    // Primeiro, listar todos os itens dispon√≠veis para debug
                    const allItems = document.querySelectorAll('.el-select-dropdown__item');
                    console.log('Itens dispon√≠veis no dropdown:');
                    allItems.forEach((item, index) => {
                        console.log(`${index}: "${item.textContent.trim()}"`);
                    });
                    
                    // Procurar pelo texto exato
                    for (let i = 0; i < allItems.length; i++) {
                        const item = allItems[i];
                        const itemText = item.textContent.trim();
                        
                        if (itemText === textoProcurar) {
                            console.log(`Encontrou item na posi√ß√£o ${i}: "${itemText}"`);
                            item.click();
                            return { success: true, found: itemText, position: i };
                        }
                    }
                    
                    // Se n√£o encontrou por texto exato, tentar por posi√ß√£o como fallback
                    console.log('N√£o encontrou por texto, tentando por posi√ß√£o...');
                    const posicaoPlanos = {
                        1: 1,   // PLANO COMPLETO - segunda op√ß√£o (√≠ndice 1)
                        3: 4,   // PLANO COMPLETO - TRIMESTRAL - quinta op√ß√£o (√≠ndice 4)
                        6: 5,   // PLANO COMPLETO - SEMESTRAL - sexta op√ß√£o (√≠ndice 5)
                        12: 6   // PLANO COMPLETO - ANUAL - s√©tima op√ß√£o (√≠ndice 6)
                    };
                    
                    const posicao = posicaoPlanos[meses] || 1;
                    
                    if (allItems[posicao]) {
                        console.log(`Clicando na posi√ß√£o ${posicao}: "${allItems[posicao].textContent.trim()}"`);
                        allItems[posicao].click();
                        return { success: true, found: allItems[posicao].textContent.trim(), position: posicao };
                    }
                    
                    return { success: false, error: 'Nenhum item encontrado' };
                }, meses);
                
                console.log('Resultado da sele√ß√£o:', planSelected);
                
                await sleep(2000); // Aguardar sele√ß√£o
                log(servidor, `Tentativa de sele√ß√£o do plano: ${planoCorreto}`);
            }
            
            // Confirmar renova√ß√£o
            const modalRenovarBtn = await page.$('#renewModal button[type="submit"]');
            if (modalRenovarBtn) {
                await modalRenovarBtn.click();
                await sleep(5000);
                log(servidor, `Renova√ß√£o de ${meses} m√™s(es) com plano ${planoCorreto} realizada com sucesso!`, 'success');
            }
            
            await page.close();
            return { sucesso: true, servidor: config.nome, meses, plano: planoCorreto };
        } else {
            log(servidor, 'Bot√£o de renova√ß√£o n√£o encontrado', 'warning');
            await page.close();
            return { sucesso: false, servidor: config.nome, erro: 'Bot√£o n√£o encontrado' };
        }
        
    } catch (error) {
        log(servidor, `Erro: ${error.message}`, 'error');
        return { sucesso: false, servidor: config.nome, erro: error.message };
    }
}

// Fun√ß√£o para renovar no Servidor 3 (Premium Server)
async function renovarServidor3(clienteId, meses, browser) {
    const servidor = 'servidor3';
    const config = SERVIDORES[servidor];
    
    try {
        log(servidor, 'Iniciando renova√ß√£o...');
        
        const page = await browser.newPage();
        await page.setViewport({ width: 1280, height: 720 });
        await page.setUserAgent('Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36');
        
        // Navegar para login
        log(servidor, 'Navegando para p√°gina de login...');
        await page.goto(`${config.url}/#/sign-in`, { waitUntil: 'networkidle0', timeout: 30000 });
        await sleep(3000);
        
        // Fazer login
        log(servidor, 'Fazendo login...');
        const userField = await page.$('input[type="text"], input[type="email"]');
        const passField = await page.$('input[type="password"]');
        
        if (userField && passField) {
            await page.evaluate((element, value) => {
                element.value = value;
                element.dispatchEvent(new Event('input', { bubbles: true }));
            }, userField, config.usuario);
            
            await page.evaluate((element, value) => {
                element.value = value;
                element.dispatchEvent(new Event('input', { bubbles: true }));
            }, passField, config.senha);
            
            const loginBtn = await page.$('button[type="submit"]');
            if (loginBtn) {
                await loginBtn.click();
                await sleep(4000);
                log(servidor, 'Login realizado!', 'success');
            }
        }
        
        // Navegar para clientes
        log(servidor, 'Navegando para p√°gina de clientes...');
        await page.goto(`${config.url}/#/customers`, { waitUntil: 'networkidle0', timeout: 30000 });
        await sleep(5000);
        
        // Buscar cliente
        log(servidor, `Buscando cliente ${clienteId}...`);
        const searchField = await page.$('input[placeholder="Pesquisar"]');
        if (searchField) {
            await page.evaluate((element, value) => {
                element.value = value;
                element.dispatchEvent(new Event('input', { bubbles: true }));
            }, searchField, clienteId);
            
            await searchField.press('Enter');
            await sleep(4000);
        }
        
        // Procurar √≠cone de renova√ß√£o espec√≠fico
        log(servidor, 'Procurando √≠cone de renova√ß√£o...');
        const renewIcon = await page.$('i.fad.fa-calendar-plus.text-white');
        
        if (renewIcon) {
            await page.evaluate((icon) => {
                const button = icon.closest('button');
                if (button) {
                    button.click();
                } else {
                    icon.parentElement.click();
                }
            }, renewIcon);
            
            await sleep(3000);
            
            // Procurar modal e selecionar plano
            const modalSelectors = ['#renewModal', '.modal.show', '.modal[style*="display: block"]'];
            let modalFound = false;
            
            for (const modalSelector of modalSelectors) {
                const modal = await page.$(modalSelector);
                if (modal) {
                    log(servidor, 'Modal de renova√ß√£o aberto');
                    
                    // Selecionar o plano correto baseado nos meses
                    const planoCorreto = obterPlano('servidor3', meses);
                    log(servidor, `Selecionando plano: ${planoCorreto}`);
                    
                    // Procurar dropdown de planos usando o seletor correto
                    const planSelect = await page.$(`${modalSelector} .el-select__selected-item, ${modalSelector} .el-select`);
                    if (planSelect) {
                        await planSelect.click();
                        await sleep(2000); // Aguardar dropdown abrir
                        
                        // Procurar e clicar na op√ß√£o do plano usando posi√ß√£o no dropdown
                        const planSelected = await page.evaluate((meses) => {
                            // Mapeamento de meses para posi√ß√£o no dropdown do Servidor 3 (baseado em zero, conforme screenshot)
                            const posicaoPlanos = {
                                1: 0,   // 1 M√äS COMPLETO C/ ADULTO - primeira op√ß√£o (√≠ndice 0)
                                3: 2,   // 3 M√äS C/ ADULTO - terceira op√ß√£o (√≠ndice 2)
                                6: 4,   // 6 M√äS C/ ADULTO - quinta op√ß√£o (√≠ndice 4)
                                12: 6   // ANUAL COMPLETO - s√©tima op√ß√£o (√≠ndice 6)
                            };
                            
                            const posicao = posicaoPlanos[meses] || 0; // Default para 1 m√™s
                            
                            setTimeout(() => {
                                const items = document.querySelectorAll('.el-select-dropdown__item, .el-popper .el-select-dropdown__item');
                                if (items && items[posicao]) {
                                    items[posicao].click();
                                    return true;
                                }
                                
                                // Fallback: tentar por texto
                                const spans = document.querySelectorAll('.el-select-dropdown span, .el-select-dropdown__item span, .el-popper span');
                                const textosProcurar = {
                                    1: '1 M√äS COMPLETO C/ ADULTO',
                                    3: '3 M√äS C/ ADULTO',
                                    6: '6 M√äS C/ ADULTO',
                                    12: 'ANUAL COMPLETO'
                                };
                                
                                const textoProcurar = textosProcurar[meses] || '1 M√äS COMPLETO C/ ADULTO';
                                
                                for (const span of spans) {
                                    if (span.textContent.trim() === textoProcurar) {
                                        const clickableElement = span.closest('.el-select-dropdown__item') || span.closest('li') || span.parentElement;
                                        if (clickableElement) {
                                            clickableElement.click();
                                            return true;
                                        }
                                    }
                                }
                                return false;
                            }, 500);
                            return true;
                        }, meses);
                        
                        await sleep(2000); // Aguardar sele√ß√£o
                        log(servidor, `Tentativa de sele√ß√£o do plano: ${planoCorreto}`);
                    }
                    
                    // Confirmar renova√ß√£o
                    const renewButton = await page.$(`${modalSelector} button[type="submit"]`);
                    if (renewButton) {
                        await renewButton.click();
                        await sleep(5000);
                        modalFound = true;
                        log(servidor, `Renova√ß√£o de ${meses} m√™s(es) com plano ${planoCorreto} realizada com sucesso!`, 'success');
                        break;
                    }
                }
            }
            
            if (!modalFound) {
                log(servidor, 'Modal de confirma√ß√£o n√£o encontrado', 'warning');
            }
            
            await page.close();
            return { sucesso: modalFound, servidor: config.nome, meses, plano: obterPlano('servidor3', meses) };
        } else {
            log(servidor, '√çcone de renova√ß√£o n√£o encontrado', 'warning');
            await page.close();
            return { sucesso: false, servidor: config.nome, erro: '√çcone n√£o encontrado' };
        }
        
    } catch (error) {
        log(servidor, `Erro: ${error.message}`, 'error');
        return { sucesso: false, servidor: config.nome, erro: error.message };
    }
}

// Fun√ß√£o principal
async function renovarTodosServidores(clienteId = '648718886', meses = 1) {
    console.log('üöÄ INICIANDO RENOVA√á√ÉO NOS 3 SERVIDORES');
    console.log(`üéØ Cliente: ${clienteId}`);
    console.log(`üìÖ Per√≠odo: ${meses} m√™s(es)`);
    console.log('=' .repeat(60));
    
    let browser;
    const resultados = [];
    
    try {
        // Lan√ßar navegador
        console.log('üåê Lan√ßando navegador...');
        browser = await puppeteer.launch({
            headless: false,
            slowMo: 500,
            args: [
                '--no-sandbox',
                '--disable-setuid-sandbox',
                '--disable-blink-features=AutomationControlled',
                '--disable-web-security'
            ]
        });
        
        console.log('‚úÖ Navegador lan√ßado!\n');
        
        // Renovar Servidor 1
        console.log('üå¥ === SERVIDOR 1: TROPICALPLAYTV ===');
        const resultado1 = await renovarServidor1(clienteId, meses, browser);
        resultados.push(resultado1);
        console.log('');
        
        // Renovar Servidor 2
        console.log('üï∑Ô∏è === SERVIDOR 2: SPIDERTV ===');
        const resultado2 = await renovarServidor2(clienteId, meses, browser);
        resultados.push(resultado2);
        console.log('');
        
        // Renovar Servidor 3
        console.log('‚≠ê === SERVIDOR 3: PREMIUM SERVER ===');
        const resultado3 = await renovarServidor3(clienteId, meses, browser);
        resultados.push(resultado3);
        console.log('');
        
        // Relat√≥rio final
        console.log('üìä === RELAT√ìRIO FINAL ===');
        console.log(`üéØ Cliente: ${clienteId}`);
        console.log(`üìÖ Per√≠odo: ${meses} m√™s(es)`);
        console.log('=' .repeat(40));
        
        let sucessos = 0;
        let falhas = 0;
        
        resultados.forEach((resultado, index) => {
            const numero = index + 1;
            if (resultado.sucesso) {
                const planoInfo = resultado.plano ? ` (${resultado.plano})` : '';
                console.log(`‚úÖ Servidor ${numero} (${resultado.servidor}): SUCESSO${planoInfo}`);
                sucessos++;
            } else {
                console.log(`‚ùå Servidor ${numero} (${resultado.servidor}): FALHA - ${resultado.erro || 'Erro desconhecido'}`);
                falhas++;
            }
        });
        
        console.log('=' .repeat(40));
        console.log(`üìà Sucessos: ${sucessos}/3`);
        console.log(`üìâ Falhas: ${falhas}/3`);
        
        if (sucessos === 3) {
            console.log('üéâ TODAS AS RENOVA√á√ïES FORAM REALIZADAS COM SUCESSO!');
        } else if (sucessos > 0) {
            console.log('‚ö†Ô∏è ALGUMAS RENOVA√á√ïES FORAM REALIZADAS COM SUCESSO');
        } else {
            console.log('üí• TODAS AS RENOVA√á√ïES FALHARAM');
        }
        
        // Aguardar para visualiza√ß√£o
        console.log('\nüëÄ Mantendo navegador aberto por 10 segundos...');
        await sleep(10000);
        
    } catch (error) {
        console.error('üí• Erro geral:', error.message);
    } finally {
        if (browser) {
            console.log('üîÑ Fechando navegador...');
            await browser.close();
            console.log('‚úÖ Navegador fechado');
        }
    }
    
    console.log('\nüèÅ PROCESSO FINALIZADO!');
}

// Executar script
const clienteId = process.argv[2] || '648718886';
const meses = parseInt(process.argv[3]) || 1;

// Validar meses
const mesesValidos = [1, 3, 6, 12];
if (!mesesValidos.includes(meses)) {
    console.error('‚ùå Per√≠odo inv√°lido! Use: 1, 3, 6 ou 12 meses');
    console.log('üí° Exemplo: node renovar-3-servidores.cjs 648718886 3');
    process.exit(1);
}

console.log(`üéØ Cliente a ser renovado: ${clienteId}`);
console.log(`üìÖ Per√≠odo: ${meses} m√™s(es)`);

// Mostrar planos que ser√£o selecionados
console.log('\nüìã Planos que ser√£o selecionados:');
console.log(`üï∑Ô∏è Servidor 2: ${obterPlano('servidor2', meses)}`);
console.log(`‚≠ê Servidor 3: ${obterPlano('servidor3', meses)}`);
console.log('');

renovarTodosServidores(clienteId, meses).catch(console.error);
